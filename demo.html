<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>產品輪播組件 Demo</title>
</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }


</style>

<body>
    <div id="infFitsHeader">
        <h2>頂部廣告區域</h2>
    </div>

    <div id="infFitsContent">
        <h1>頁面內容</h1>
        <p>這是一個示例頁面內容</p>
    </div>

    <div id="infFitsFooter">
        <h2>底部廣告區域</h2>
    </div>



    <script>
        // 整合的彈窗處理函數
        function handlePopup() {
                // 創建並添加 CSS 樣式
                const popupStyles = `
                #infPopupproductCarousel *{
                    margin: 0;
                    padding: 0;
                    box-sizing: border-box;
                }
                #infPopupproductCarousel {
                    position: fixed;
                    left: -400px;
                    bottom: 20px;
                    width: 350px;
                    max-width: calc(100vw - 40px);
                    height: 300px;
                    background: rgba(255, 255, 255, 0.98);
                    border-radius: 16px;
                    box-shadow: 
                        0 8px 32px rgba(0, 0, 0, 0.08),
                        0 2px 8px rgba(0, 0, 0, 0.04),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
                    z-index: 1000;
                    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                    border: 1px solid rgba(0, 0, 0, 0.06);
                    backdrop-filter: blur(20px);
                }

                /* 小螢幕響應式設計 */
                @media (max-width: 480px) {
                    #infPopupproductCarousel {
                        width: calc(100vw - 40px);
                        left: -100vw;
                        bottom: 16px;
                        border-radius: 12px;
                        max-height: 250px;
                    }
                    
                    #infPopupproductCarousel.show {
                        left: 20px;
                    }
                }

                /* 超小螢幕響應式設計 */
                @media (max-width: 360px) {
                    #infPopupproductCarousel {
                        width: calc(100vw - 24px);
                        left: -100vw;
                        bottom: 12px;
                        border-radius: 10px;
                    }
                    
                    #infPopupproductCarousel.show {
                        left: 12px;
                    }
                }

                #infPopupproductCarousel.show {
                    left: 20px;
                }

                .popup-close-btn {
                    position: absolute;
                    top: 8px;
                    right: 8px;
                    width: 24px;
                    height: 24px;
                    background: rgba(255, 255, 255, 0.95);
                    border: 1px solid rgba(0, 0, 0, 0.08);
                    border-radius: 50%;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 16px;
                    font-weight: 300;
                    color: rgba(0, 0, 0, 0.6);
                    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                    z-index: 10;
                    backdrop-filter: blur(8px);
                    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                    line-height: 1;
                }

                .popup-close-btn:hover {
                    background: rgba(0, 0, 0, 0.05);
                    border-color: rgba(0, 0, 0, 0.12);
                    color: rgba(0, 0, 0, 0.8);
                    transform: scale(1.05);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                }

                .popup-close-btn:active {
                    transform: scale(0.95);
                    background: rgba(0, 0, 0, 0.08);
                }

                .popup-content {
                    padding: 12px;
                    height: 100%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    max-width: 100%;
                    overflow: hidden;
                }
                
                /* 確保組件在 popup 內正確顯示 */
                #infPopupproductCarousel {
                    position: fixed;
                    left: -500px;
                    bottom: 20px;
                    width: 450px;
                    max-width: calc(100vw - 40px);
                    background: rgba(255, 255, 255, 0.98);
                    border-radius: 16px;
                    box-shadow: 
                        0 8px 32px rgba(0, 0, 0, 0.08),
                        0 2px 8px rgba(0, 0, 0, 0.04),
                        inset 0 1px 0 rgba(255, 255, 255, 0.8);
                    z-index: 1000;
                    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                    border: 1px solid rgba(0, 0, 0, 0.06);
                    backdrop-filter: blur(20px);
                    overflow: hidden;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }

                #infPopupproductCarousel.show {
                    left: 20px;
                }
                
                /* 限制組件在 popup 內的顯示 */
                #infPopupproductCarousel inf-product-carousel-component {
                    width: 100% !important;
                    height: 100% !important;
                    max-width: 100% !important;
                    max-height: 100% !important;
                    overflow: hidden !important;
                }
                /* 確保 popupProductContent 容器正確限制組件 */
                  #popupProductContent #recommendation-loading {
                    width: 100% !important;
                    height: 100% !important;
                    max-width: 100% !important;
                    max-height: 100% !important;
                    overflow: visible !important;
                    position: relative !important;
                }
                
                /* 防止組件內容溢出 */
                 #popupProductContent * {
                    max-width: 100% !important;
                    box-sizing: border-box !important;
                }
            `;

                // 添加樣式到 head
                const styleElement = document.createElement('style');
                styleElement.textContent = popupStyles;
                document.head.appendChild(styleElement);

                // 創建彈窗 HTML 元素
                const popupHTML = `
                <div id="infPopupproductCarousel">
                    <button class="popup-close-btn" onclick="closePopup()">×</button>
                    <div class="popup-content">
                        <div id="popupProductContent" style="width: 100%; height: 100%; overflow: hidden;">
                        </div>
                    </div>
                </div>
            `;

                // 添加彈窗到 body
                document.body.insertAdjacentHTML('beforeend', popupHTML);

                const popup = document.getElementById('infPopupproductCarousel');

                // 顯示彈窗
                function showPopup() {
                    popup.classList.add('show');
                }

                // 關閉彈窗
                function closePopup() {
                    popup.classList.remove('show');
                }

                // 點擊彈窗外部關閉彈窗
                document.addEventListener('click', function (event) {
                    if (event.target === popup) {
                        closePopup();
                    }
                });

                // 延遲1秒後顯示彈窗
                setTimeout(showPopup, 1000);

                // 將 closePopup 函數設為全域可訪問，供關閉按鈕使用
                window.closePopup = closePopup;
            }


        // 頁面載入完成後初始化
        document.addEventListener('DOMContentLoaded', function () {
            // 初始化彈窗
            handlePopup();
            
            // 等待彈窗初始化完成後再載入腳本
            setTimeout(() => {
                // 載入腳本
                const script = document.createElement('script');
                // script.src = 'https://ts-inf-product-carousel-component.vercel.app/inf-product-carousel-component.js';
                script.src = './inf-product-carousel-component.js';
                script.async = true;
                script.onload = function () {
                    const config = {
                        brand: 'ALMI',
                        carousels: [
                            {
                                type: 'popup',
                                showPositionId: {
                                    top:'popupProductContent',
                                    bottom:'popupProductContent'
                                },
                                brandConfig: {
                                    "DisplayMode": "SocialProofNum",
                                    "CarouselButton": true,
                                    "Description": "",
                                    "RecommendMode": "bhv,corr,sp_atc_sp_trans",
                                    "CarouselLayout": 3,
                                    "Title": "您可能會喜歡",
                                    "Location": "bottom",
                                    "status": true
                                }
                            },
                            {
                                type: 'product',
                                showPositionId: {
                                    top: 'infFitsHeader',
                                    bottom: 'infFitsFooter'
                                }
                            }
                        ]
                    };
                    config.carousels.forEach(carousel => {
                        console.log('carousel', carousel);
                        const productCarouselconfig = {
                            brand: config.brand,
                           carousel
                        };
                        // 初始化組件
                        window.initInfProductCarouselComponent(productCarouselconfig);
                    });
                };
                document.head.appendChild(script);
            }, 100); // 等待 100ms 確保彈窗初始化完成
        });
    </script>
</body>

</html>